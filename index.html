<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ü–ª—é—Å–∏–∫–∏</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: sans-serif; background:#f6f7fb; text-align:center; }
    .card { background:#fff; padding:20px; margin:20px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,.2); }
    button { padding:10px 20px; border:none; border-radius:8px; background:#2563eb; color:#fff; cursor:pointer; }
  </style>
</head>
<body>
  <div id="content" class="card">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();
const user = tg.initDataUnsafe?.user;

const students = [123456789, 6340694282];
const teachers = [222222222, 333333333];

async function render() {
  if (!user) {
    document.getElementById("content").innerHTML = "–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏";
    return;
  }

  if (teachers.includes(user.id)) {
    document.getElementById("content").innerHTML = `
      <h2>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
      <label>–í—ã–±–µ—Ä–∏ —É—á–µ–Ω–∏–∫–∞:</label><br>
      <select id="student">
        ${students.map(id => `<option value="${id}">${id}</option>`).join("")}
      </select><br><br>
      <button onclick="givePlus()">–í—ã–¥–∞—Ç—å –ø–ª—é—Å–∏–∫</button>
    `;
  } else if (students.includes(user.id)) {
    const res = await fetch("/api/balance?user_id=" + user.id);
    const data = await res.json();
    document.getElementById("content").innerHTML = `
      <h2>–¢–≤–æ–π –±–∞–ª–∞–Ω—Å</h2>
      <p>–£ —Ç–µ–±—è ${data.balance} –ø–ª—é—Å–∏–∫–æ–≤</p>
    `;
  } else {
    document.getElementById("content").innerHTML = "–¢—ã –Ω–µ –≤ —Å–∏—Å—Ç–µ–º–µ üëÄ";
  }
}

async function givePlus() {
  const studentId = document.getElementById("student").value;
  await fetch("/api/give", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({teacher_id: user.id, student_id: studentId})
  });
  alert("–ü–ª—é—Å–∏–∫ –≤—ã–¥–∞–Ω!");
}

render();
</script>
</body>
</html>


